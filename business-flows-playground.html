<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Business Flows — Design Playground v2</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --brand-green: #3FAF7A;
    --brand-green-dark: #25785A;
    --brand-green-light: #4CC08C;
    --brand-navy: #0A1E2F;
    --brand-slate: #0D2A35;
    --text-primary: #333333;
    --text-secondary: #666666;
    --text-muted: #999999;
    --page-bg: #F4F4F4;
    --card-bg: #FFFFFF;
    --border: #E5E5E5;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: #1a1a2e;
    color: #e0e0e0;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* ─── Controls Panel ─── */
  .controls {
    width: 310px;
    min-width: 310px;
    background: #16162a;
    border-right: 1px solid #2a2a4a;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .controls h1 { font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 2px; }
  .controls .subtitle { font-size: 11px; color: #888; margin-bottom: 4px; }

  .control-group {
    background: #1e1e38;
    border-radius: 10px;
    padding: 14px;
  }

  .control-group h3 {
    font-size: 11px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.8px; color: #888; margin-bottom: 10px;
  }

  .control-row {
    display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;
  }
  .control-row:last-child { margin-bottom: 0; }
  .control-row label { font-size: 12px; color: #ccc; }

  .toggle { position: relative; width: 36px; height: 20px; cursor: pointer; }
  .toggle input { display: none; }
  .toggle .track {
    position: absolute; inset: 0; background: #333; border-radius: 10px; transition: background 0.2s;
  }
  .toggle input:checked + .track { background: var(--brand-green); }
  .toggle .thumb {
    position: absolute; top: 2px; left: 2px; width: 16px; height: 16px;
    background: #fff; border-radius: 50%; transition: transform 0.2s; pointer-events: none;
  }
  .toggle input:checked ~ .thumb { transform: translateX(16px); }

  .ctrl-select {
    background: #2a2a4a; border: 1px solid #3a3a5a; color: #e0e0e0;
    font-size: 11px; padding: 4px 8px; border-radius: 6px; font-family: inherit; cursor: pointer;
  }

  .presets { display: flex; flex-wrap: wrap; gap: 6px; }
  .preset-btn {
    background: #2a2a4a; border: 1px solid #3a3a5a; color: #ccc;
    font-size: 11px; padding: 5px 10px; border-radius: 6px; cursor: pointer;
    font-family: inherit; transition: all 0.15s;
  }
  .preset-btn:hover { background: #3a3a5a; color: #fff; }
  .preset-btn.active { background: var(--brand-green); border-color: var(--brand-green); color: #fff; }

  .slider-row { display: flex; align-items: center; gap: 8px; }
  .slider-row input[type="range"] { flex: 1; accent-color: var(--brand-green); height: 4px; }
  .slider-val { font-size: 11px; color: #888; min-width: 30px; text-align: right; font-family: monospace; }

  /* ─── Main Area ─── */
  .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

  .preview-container { flex: 1; overflow-y: auto; padding: 32px; background: var(--page-bg); }
  .preview-inner { max-width: 1100px; margin: 0 auto; display: flex; flex-direction: column; gap: 16px; }

  /* ─── Workflow Card ─── */
  .wf-card {
    background: var(--card-bg); border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden; border: 1px solid var(--border);
  }

  .wf-header {
    display: flex; align-items: center; padding: 16px 20px; cursor: pointer;
    user-select: none; gap: 12px; transition: background 0.15s;
  }
  .wf-header:hover { background: #FAFAFA; }

  .wf-toggle {
    font-size: 10px; color: var(--text-muted); transition: transform 0.2s;
    width: 14px; flex-shrink: 0;
  }
  .wf-toggle.open { transform: rotate(90deg); }

  .wf-name { font-size: 16px; font-weight: 600; color: var(--text-primary); flex-shrink: 0; }

  .wf-meta { display: flex; align-items: center; gap: 16px; margin-left: auto; flex-shrink: 0; }
  .wf-meta-item { font-size: 13px; color: var(--text-muted); }
  .wf-benefit { font-size: 13px; font-weight: 600; color: var(--brand-green); }

  .wf-body { overflow: hidden; transition: max-height 0.3s ease, opacity 0.2s ease; }
  .wf-body.collapsed { max-height: 0; opacity: 0; }
  .wf-body.expanded { max-height: 4000px; opacity: 1; }

  /* Description block */
  .wf-description {
    margin: 0 20px 16px; padding: 12px 16px;
    background: #F8F9FA; border-radius: 8px; border-left: 3px solid var(--brand-green);
  }
  .wf-description p {
    font-size: 13px; color: var(--text-secondary); line-height: 1.6;
  }

  /* Actor pills */
  .wf-actors {
    margin: 0 20px 16px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  }
  .wf-actors-label {
    font-size: 11px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.5px; color: var(--text-muted);
  }
  .actor-pill {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 500;
  }
  .actor-pill .actor-dot { width: 7px; height: 7px; border-radius: 50%; }
  .actor-pill.consultant { background: #EDF7F1; color: var(--brand-green-dark); }
  .actor-pill.consultant .actor-dot { background: var(--brand-green); }
  .actor-pill.system { background: #F0F4F8; color: var(--brand-navy); }
  .actor-pill.system .actor-dot { background: var(--brand-navy); }
  .actor-pill.participant { background: #F5F5F5; color: var(--text-secondary); }
  .actor-pill.participant .actor-dot { background: #999; }
  .actor-pill.client { background: #F0F4F8; color: #4A6FA5; }
  .actor-pill.client .actor-dot { background: #4A6FA5; }

  .wf-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 0; padding: 0 20px 20px; }
  .wf-columns.stacked { grid-template-columns: 1fr; gap: 24px; }

  .wf-column { padding: 0 12px; }
  .wf-columns:not(.stacked) .wf-column:first-child { border-right: 1px solid var(--border); padding-left: 0; }
  .wf-columns:not(.stacked) .wf-column:last-child { padding-right: 0; }
  .wf-columns.stacked .wf-column { padding: 0; }

  .col-label {
    font-size: 11px; font-weight: 700; letter-spacing: 0.8px;
    text-transform: uppercase; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid;
  }

  /* ─── Steps ─── */
  .step-item { display: flex; align-items: flex-start; gap: 10px; position: relative; padding-bottom: 6px; }
  .step-badge-col { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; width: 24px; }

  .step-badge {
    width: 24px; height: 24px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 600; color: #fff; flex-shrink: 0;
  }

  .step-connector { width: 2px; flex: 1; min-height: 6px; margin-top: 3px; }
  .step-connector.current { background: #E0E0E0; }
  .step-connector.future { background: #C8E6D8; }
  .step-connector.hidden { background: transparent; }

  .step-card {
    background: #FAFAFA; border: 1px solid var(--border);
    border-radius: 8px; padding: 10px 12px; flex: 1;
  }
  .step-card p { font-size: 13px; color: var(--text-primary); line-height: 1.5; }
  .step-card .step-time { font-size: 11px; color: var(--text-muted); margin-top: 3px; }

  /* Actor tag inside step */
  .step-actor-tag {
    display: inline-flex; align-items: center; gap: 3px;
    font-size: 10px; font-weight: 500; color: var(--text-muted);
    margin-top: 4px;
  }
  .step-actor-tag .sa-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--text-muted); }
  .step-actor-tag.consultant .sa-dot { background: var(--brand-green); }
  .step-actor-tag.consultant { color: var(--brand-green-dark); }
  .step-actor-tag.system .sa-dot { background: var(--brand-navy); }
  .step-actor-tag.system { color: var(--brand-navy); }

  /* Pain / Benefit */
  .step-pain { font-size: 11px; color: var(--text-muted); margin-top: 4px; font-style: italic; }
  .step-benefit { font-size: 11px; color: var(--brand-green-dark); margin-top: 4px; font-style: italic; }

  /* ─── ROI Footer ─── */
  .roi-footer {
    background: #F8FBF9; border-top: 1px solid var(--border);
    padding: 14px 20px; display: flex; align-items: center; gap: 24px; flex-wrap: wrap;
  }
  .roi-stat { display: flex; flex-direction: column; gap: 2px; }
  .roi-stat .roi-label {
    font-size: 10px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.5px; color: var(--text-muted);
  }
  .roi-stat .roi-value { font-size: 15px; font-weight: 700; color: var(--brand-green); }
  .roi-bar-container { flex: 1; min-width: 120px; }
  .roi-bar-label { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; }
  .roi-bar-track { height: 6px; background: #E8E8E8; border-radius: 3px; overflow: hidden; }
  .roi-bar-fill {
    height: 100%; background: linear-gradient(90deg, var(--brand-green), var(--brand-green-light));
    border-radius: 3px; transition: width 0.4s ease;
  }

  /* ─── Prompt Output ─── */
  .prompt-panel {
    background: #16162a; border-top: 1px solid #2a2a4a;
    padding: 16px 24px; min-height: 100px; max-height: 180px;
    overflow-y: auto; position: relative;
  }
  .prompt-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: #666; margin-bottom: 8px; }
  .prompt-text { font-size: 12px; color: #ccc; line-height: 1.6; font-family: 'SF Mono', 'Fira Code', monospace; white-space: pre-wrap; }

  .copy-btn {
    position: absolute; top: 14px; right: 20px;
    background: #2a2a4a; border: 1px solid #3a3a5a; color: #ccc;
    font-size: 11px; padding: 5px 12px; border-radius: 6px; cursor: pointer;
    font-family: inherit; transition: all 0.15s;
  }
  .copy-btn:hover, .copy-btn.copied { background: var(--brand-green); border-color: var(--brand-green); color: #fff; }
</style>
</head>
<body>

<div class="controls">
  <div>
    <h1>Business Flows v2</h1>
    <div class="subtitle">Workflow pair design — greens & greys palette</div>
  </div>

  <div class="control-group">
    <h3>Presets</h3>
    <div class="presets">
      <button class="preset-btn active" onclick="applyPreset('polished')">Polished</button>
      <button class="preset-btn" onclick="applyPreset('full')">Full Detail</button>
      <button class="preset-btn" onclick="applyPreset('clean')">Clean</button>
      <button class="preset-btn" onclick="applyPreset('compact')">Compact</button>
    </div>
  </div>

  <div class="control-group">
    <h3>Layout</h3>
    <div class="control-row">
      <label>Column mode</label>
      <select class="ctrl-select" id="ctrl-layout" onchange="state.layout=this.value;updateAll()">
        <option value="side-by-side">Side by side</option>
        <option value="stacked">Stacked</option>
      </select>
    </div>
    <div class="control-row">
      <label>Card radius</label>
      <div class="slider-row">
        <input type="range" min="0" max="24" value="12" id="ctrl-radius" oninput="state.cardRadius=+this.value;updateAll()">
        <span class="slider-val" id="val-radius">12</span>
      </div>
    </div>
  </div>

  <div class="control-group">
    <h3>Content</h3>
    <div class="control-row">
      <label>Process description</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-desc" checked onchange="state.showDescription=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>Actor personas</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-actors" checked onchange="state.showActors=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>Actor tags on steps</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-step-actors" checked onchange="state.showStepActors=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>Step times</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-times" checked onchange="state.showTimes=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>Pain / benefit notes</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-pain" checked onchange="state.showPainBenefit=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>Connector lines</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-connectors" checked onchange="state.showConnectors=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>ROI footer</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-roi" onchange="state.showROI=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
    <div class="control-row">
      <label>Expand all</label>
      <label class="toggle">
        <input type="checkbox" id="ctrl-expand" checked onchange="state.expandAll=this.checked;updateAll()">
        <div class="track"></div><div class="thumb"></div>
      </label>
    </div>
  </div>

  <div class="control-group">
    <h3>Colors — Current State</h3>
    <div class="control-row">
      <label>Label color</label>
      <select class="ctrl-select" id="ctrl-current-label" onchange="state.currentLabelColor=this.value;updateAll()">
        <option value="#666666">Gray (#666)</option>
        <option value="#999999">Muted (#999)</option>
        <option value="#333333">Dark (#333)</option>
        <option value="#0A1E2F">Navy</option>
      </select>
    </div>
    <div class="control-row">
      <label>Badge color</label>
      <select class="ctrl-select" id="ctrl-current-badge" onchange="state.currentBadgeColor=this.value;updateAll()">
        <option value="#666666">Gray (#666)</option>
        <option value="#333333">Dark (#333)</option>
        <option value="#999999">Muted (#999)</option>
        <option value="#0A1E2F">Navy</option>
      </select>
    </div>
    <div class="control-row">
      <label>Pain text style</label>
      <select class="ctrl-select" id="ctrl-pain-style" onchange="state.painStyle=this.value;updateAll()">
        <option value="muted-italic">Muted italic</option>
        <option value="gray-normal">Gray normal</option>
        <option value="subtle-bg">Subtle background</option>
      </select>
    </div>
  </div>

  <div class="control-group">
    <h3>Colors — Future State</h3>
    <div class="control-row">
      <label>Label color</label>
      <select class="ctrl-select" id="ctrl-future-label" onchange="state.futureLabelColor=this.value;updateAll()">
        <option value="#25785A">Dark Green</option>
        <option value="#3FAF7A">Brand Green</option>
        <option value="#0A1E2F">Navy</option>
      </select>
    </div>
    <div class="control-row">
      <label>Badge color</label>
      <select class="ctrl-select" id="ctrl-future-badge" onchange="state.futureBadgeColor=this.value;updateAll()">
        <option value="#3FAF7A">Brand Green</option>
        <option value="#25785A">Dark Green</option>
        <option value="#0A1E2F">Navy</option>
        <option value="#333333">Dark (match current)</option>
      </select>
    </div>
  </div>
</div>

<div class="main">
  <div class="preview-container"><div class="preview-inner" id="preview"></div></div>
  <div class="prompt-panel">
    <div class="prompt-label">Implementation Prompt</div>
    <button class="copy-btn" id="copy-btn" onclick="copyPrompt()">Copy</button>
    <div class="prompt-text" id="prompt-text"></div>
  </div>
</div>

<script>
const workflows = [
  {
    name: "Assessment Distribution",
    description: "The process of distributing organizational health assessments to client team members. Currently relies on manual email workflows with PDF attachments; the future state automates distribution with trackable magic links.",
    actors: [
      { name: "Consultant", type: "consultant" },
      { name: "System", type: "system" },
    ],
    currentTime: "2-4 hours over 2-4 weeks",
    futureTime: "10-15 minutes",
    benefit: "Saves 2-4 hours per assessment",
    roi: { timeSavedPct: 92, costWeek: "$480", costYear: "$24,960", stepsAutomated: 4, stepsTotal: 5 },
    current: [
      { label: "Consultant creates list of team members who should complete the assessment", time: "15 min", actor: "Consultant", actorType: "consultant" },
      { label: "Consultant emails each person individually with PDF attachment and instructions", time: "30 min", actor: "Consultant", actorType: "consultant", pain: "Repetitive, error-prone process" },
      { label: "Consultant follows up via email/phone when responses don't come back", time: "45 min", actor: "Consultant", actorType: "consultant", pain: "Time-consuming follow-ups over days/weeks" },
      { label: "Some respondents print, handwrite, and scan back; others fill PDF digitally", time: "20 min", actor: "Participant", actorType: "participant", pain: "Inconsistent formats make data aggregation hard" },
      { label: "Consultant tracks responses in personal spreadsheet", time: "15 min", actor: "Consultant", actorType: "consultant" },
    ],
    future: [
      { label: "Consultant selects organization and clicks \"Send Assessment\"", time: "2 min", actor: "Consultant", actorType: "consultant", benefit: "One-click distribution" },
      { label: "Consultant enters participant names, emails, and roles", time: "3 min", actor: "Consultant", actorType: "consultant" },
      { label: "System generates unique magic link for each participant", time: "instant", actor: "System", actorType: "system", benefit: "Zero friction for participants" },
      { label: "Consultant copies links and sends via preferred channel (email, Slack, etc.)", time: "2 min", actor: "Consultant", actorType: "consultant" },
      { label: "System tracks who has opened, started, and completed in real time", time: "automatic", actor: "System", actorType: "system", benefit: "Real-time visibility replaces manual tracking" },
    ]
  },
  {
    name: "Assessment Completion",
    description: "How individual participants experience and complete the assessment. The current PDF-based flow creates friction and abandonment; the future state provides a guided web experience with auto-save and adaptive questioning.",
    actors: [
      { name: "Participant", type: "participant" },
      { name: "System", type: "system" },
      { name: "Consultant", type: "consultant" },
    ],
    currentTime: "30-45 min (plus delays)",
    futureTime: "15-25 min",
    benefit: "Faster, frictionless experience",
    roi: { timeSavedPct: 55, costWeek: "$200", costYear: "$10,400", stepsAutomated: 3, stepsTotal: 5 },
    current: [
      { label: "Participant receives PDF via email, often buried in inbox", time: "varies", actor: "Participant", actorType: "participant", pain: "Low open rates, emails get lost" },
      { label: "Participant downloads and opens PDF in a viewer or prints it", time: "5 min", actor: "Participant", actorType: "participant" },
      { label: "Participant answers 30-40 questions by typing or handwriting", time: "25 min", actor: "Participant", actorType: "participant", pain: "Fatigue leads to incomplete responses" },
      { label: "Participant saves/scans and sends back via email reply", time: "5 min", actor: "Participant", actorType: "participant" },
      { label: "Some participants forget and need multiple reminders", time: "days", actor: "Consultant", actorType: "consultant", pain: "Delays cascade to project timeline" },
    ],
    future: [
      { label: "Participant clicks magic link — opens directly in browser", time: "instant", actor: "Participant", actorType: "participant", benefit: "No downloads, no friction" },
      { label: "Guided assessment interface with progress bar and save-and-continue", time: "15 min", actor: "Participant", actorType: "participant", benefit: "Better completion rates" },
      { label: "Adaptive follow-up questions based on role and prior answers", time: "5 min", actor: "System", actorType: "system", benefit: "Smarter, shorter assessments" },
      { label: "System auto-saves progress; participant can resume any time", time: "0 min", actor: "System", actorType: "system" },
      { label: "Automatic reminder emails for incomplete assessments", time: "0 min", actor: "System", actorType: "system", benefit: "No manual follow-up needed" },
    ]
  },
  {
    name: "Results Analysis",
    description: "Turning raw assessment responses into actionable insights and recommendations. Currently a multi-hour manual process of data entry and slide creation; the future state uses AI to aggregate, cluster, and draft findings automatically.",
    actors: [
      { name: "Consultant", type: "consultant" },
      { name: "System", type: "system" },
      { name: "Client Stakeholders", type: "client" },
    ],
    currentTime: "4-8 hours",
    futureTime: "30 minutes",
    benefit: "Saves 4-7 hours per project",
    roi: { timeSavedPct: 88, costWeek: "$720", costYear: "$37,440", stepsAutomated: 4, stepsTotal: 5 },
    current: [
      { label: "Consultant manually copies answers from PDFs into a master spreadsheet", time: "2 hrs", actor: "Consultant", actorType: "consultant", pain: "Tedious data entry, transcription errors" },
      { label: "Consultant groups and categorizes responses by theme", time: "1 hr", actor: "Consultant", actorType: "consultant" },
      { label: "Consultant identifies patterns, outliers, and consensus points", time: "1.5 hrs", actor: "Consultant", actorType: "consultant", pain: "Subjective, depends on consultant experience" },
      { label: "Consultant creates charts and summary slides in PowerPoint", time: "1.5 hrs", actor: "Consultant", actorType: "consultant" },
      { label: "Consultant writes narrative analysis and recommendations", time: "2 hrs", actor: "Consultant", actorType: "consultant" },
    ],
    future: [
      { label: "System aggregates all responses automatically as they come in", time: "instant", actor: "System", actorType: "system", benefit: "Zero data entry" },
      { label: "AI clusters responses by theme and identifies consensus/divergence", time: "2 min", actor: "System", actorType: "system", benefit: "Objective, consistent analysis" },
      { label: "Interactive dashboard shows real-time results with filters", time: "5 min", actor: "Client Stakeholders", actorType: "client", benefit: "Stakeholders can explore data themselves" },
      { label: "System generates draft narrative with key findings and evidence", time: "5 min", actor: "System", actorType: "system", benefit: "Hours of writing reduced to review" },
      { label: "Consultant reviews, refines, and adds strategic recommendations", time: "20 min", actor: "Consultant", actorType: "consultant" },
    ]
  }
];

const DEFAULTS = {
  layout: 'side-by-side',
  cardRadius: 12,
  showDescription: true,
  showActors: true,
  showStepActors: true,
  showTimes: true,
  showPainBenefit: true,
  showConnectors: true,
  showROI: false,
  expandAll: true,
  currentLabelColor: '#666666',
  currentBadgeColor: '#666666',
  futureLabelColor: '#25785A',
  futureBadgeColor: '#3FAF7A',
  painStyle: 'muted-italic',
};

const state = { ...DEFAULTS };

const presets = {
  polished: { ...DEFAULTS },
  full: {
    ...DEFAULTS, showROI: true, showDescription: true, showActors: true,
    showStepActors: true, showPainBenefit: true, painStyle: 'subtle-bg',
  },
  clean: {
    ...DEFAULTS, showDescription: true, showActors: true,
    showStepActors: false, showPainBenefit: false, showROI: false,
    showTimes: true,
  },
  compact: {
    ...DEFAULTS, showDescription: false, showActors: false,
    showStepActors: false, showPainBenefit: false, showROI: false,
    showTimes: false, showConnectors: false, cardRadius: 8,
  },
};

function applyPreset(name) {
  Object.assign(state, presets[name]);
  syncControls();
  updateAll();
  document.querySelectorAll('.preset-btn').forEach(b =>
    b.classList.toggle('active', b.textContent.toLowerCase() === name)
  );
}

function syncControls() {
  document.getElementById('ctrl-layout').value = state.layout;
  document.getElementById('ctrl-radius').value = state.cardRadius;
  document.getElementById('ctrl-desc').checked = state.showDescription;
  document.getElementById('ctrl-actors').checked = state.showActors;
  document.getElementById('ctrl-step-actors').checked = state.showStepActors;
  document.getElementById('ctrl-times').checked = state.showTimes;
  document.getElementById('ctrl-pain').checked = state.showPainBenefit;
  document.getElementById('ctrl-connectors').checked = state.showConnectors;
  document.getElementById('ctrl-roi').checked = state.showROI;
  document.getElementById('ctrl-expand').checked = state.expandAll;
  document.getElementById('ctrl-current-label').value = state.currentLabelColor;
  document.getElementById('ctrl-current-badge').value = state.currentBadgeColor;
  document.getElementById('ctrl-future-label').value = state.futureLabelColor;
  document.getElementById('ctrl-future-badge').value = state.futureBadgeColor;
  document.getElementById('ctrl-pain-style').value = state.painStyle;
  document.getElementById('val-radius').textContent = state.cardRadius;
}

function renderStep(step, index, type, isLast) {
  const badgeColor = type === 'future' ? state.futureBadgeColor : state.currentBadgeColor;
  const connClass = state.showConnectors && !isLast ? type : 'hidden';

  let extras = '';

  if (state.showStepActors && step.actor) {
    extras += `<div class="step-actor-tag ${step.actorType || ''}"><span class="sa-dot"></span>${step.actor}</div>`;
  }

  if (state.showTimes && step.time) {
    extras += `<div class="step-time">${step.time}</div>`;
  }

  if (state.showPainBenefit && step.pain) {
    if (state.painStyle === 'subtle-bg') {
      extras += `<div style="font-size:11px;color:#666;margin-top:5px;padding:4px 8px;background:#F5F5F5;border-radius:4px;font-style:italic">⚠ ${step.pain}</div>`;
    } else if (state.painStyle === 'gray-normal') {
      extras += `<div style="font-size:11px;color:#888;margin-top:4px">⚠ ${step.pain}</div>`;
    } else {
      extras += `<div class="step-pain">⚠ ${step.pain}</div>`;
    }
  }

  if (state.showPainBenefit && step.benefit) {
    extras += `<div class="step-benefit">✦ ${step.benefit}</div>`;
  }

  return `
    <div class="step-item">
      <div class="step-badge-col">
        <div class="step-badge" style="background:${badgeColor}">${index + 1}</div>
        <div class="step-connector ${connClass}"></div>
      </div>
      <div class="step-card">
        <p>${step.label}</p>
        ${extras}
      </div>
    </div>`;
}

function renderWorkflow(wf, idx) {
  const isOpen = state.expandAll;

  let descHtml = '';
  if (state.showDescription && wf.description) {
    descHtml = `<div class="wf-description"><p>${wf.description}</p></div>`;
  }

  let actorsHtml = '';
  if (state.showActors && wf.actors && wf.actors.length) {
    const pills = wf.actors.map(a =>
      `<span class="actor-pill ${a.type}"><span class="actor-dot"></span>${a.name}</span>`
    ).join('');
    actorsHtml = `<div class="wf-actors"><span class="wf-actors-label">Actors</span>${pills}</div>`;
  }

  const currentSteps = wf.current.map((s, i) => renderStep(s, i, 'current', i === wf.current.length - 1)).join('');
  const futureSteps = wf.future.map((s, i) => renderStep(s, i, 'future', i === wf.future.length - 1)).join('');

  let roiHtml = '';
  if (state.showROI && wf.roi) {
    const pct = Math.round(wf.roi.stepsAutomated / wf.roi.stepsTotal * 100);
    roiHtml = `
      <div class="roi-footer">
        <div class="roi-stat"><span class="roi-label">Time Saved</span><span class="roi-value">${wf.roi.timeSavedPct}%</span></div>
        <div class="roi-bar-container">
          <div class="roi-bar-label">Automation coverage</div>
          <div class="roi-bar-track"><div class="roi-bar-fill" style="width:${pct}%"></div></div>
        </div>
        <div class="roi-stat"><span class="roi-label">Cost / Week</span><span class="roi-value">${wf.roi.costWeek}</span></div>
        <div class="roi-stat"><span class="roi-label">Cost / Year</span><span class="roi-value">${wf.roi.costYear}</span></div>
        <div class="roi-stat"><span class="roi-label">Automated</span><span class="roi-value">${wf.roi.stepsAutomated}/${wf.roi.stepsTotal}</span></div>
      </div>`;
  }

  return `
    <div class="wf-card" style="border-radius:${state.cardRadius}px">
      <div class="wf-header" onclick="toggleCard(${idx})">
        <span class="wf-toggle ${isOpen ? 'open' : ''}" id="toggle-${idx}">▶</span>
        <span class="wf-name">${wf.name}</span>
        <div class="wf-meta">
          <span class="wf-meta-item">Current: ${wf.currentTime}</span>
          <span class="wf-meta-item">Future: ${wf.futureTime}</span>
          <span class="wf-benefit">${wf.benefit}</span>
        </div>
      </div>
      <div class="wf-body ${isOpen ? 'expanded' : 'collapsed'}" id="body-${idx}">
        ${descHtml}
        ${actorsHtml}
        <div class="wf-columns ${state.layout === 'stacked' ? 'stacked' : ''}">
          <div class="wf-column">
            <div class="col-label" style="color:${state.currentLabelColor};border-color:${state.currentLabelColor}">Current (Manual)</div>
            <div class="steps-list">${currentSteps}</div>
          </div>
          <div class="wf-column">
            <div class="col-label" style="color:${state.futureLabelColor};border-color:${state.futureLabelColor}">Future (Automated)</div>
            <div class="steps-list">${futureSteps}</div>
          </div>
        </div>
        ${roiHtml}
      </div>
    </div>`;
}

function toggleCard(idx) {
  const body = document.getElementById('body-' + idx);
  const toggle = document.getElementById('toggle-' + idx);
  const isOpen = body.classList.contains('expanded');
  body.classList.toggle('expanded', !isOpen);
  body.classList.toggle('collapsed', isOpen);
  toggle.classList.toggle('open', !isOpen);
}

function renderPreview() {
  document.getElementById('preview').innerHTML = workflows.map((wf, i) => renderWorkflow(wf, i)).join('');
  document.getElementById('val-radius').textContent = state.cardRadius;
}

function updatePrompt() {
  const p = [];
  p.push(`Redesign the WorkflowsSection component to use the "Business Flows" accordion layout with greens/greys palette (no red).`);
  p.push(`Each WorkflowPair renders as a collapsible card (border-radius ${state.cardRadius}px) with a header showing: workflow name (bold), current time estimate (gray), future time estimate (gray), and a green benefit summary.`);

  if (state.showDescription) {
    p.push(`Below the header, show a process description block with a left green border accent on a light gray (#F8F9FA) background.`);
  }
  if (state.showActors) {
    p.push(`Show actor persona pills below the description — each pill has a colored dot and label. Actor types: consultant (green), system (navy), participant (gray), client (blue). Use pill style: rounded-full, small text, subtle background matching the actor color.`);
  }

  p.push(`Use a ${state.layout} two-column layout: "CURRENT (MANUAL)" label in ${state.currentLabelColor}, "FUTURE (AUTOMATED)" label in ${state.futureLabelColor}.`);
  p.push(`Each step has a 24px circular numbered badge (current: ${state.currentBadgeColor}, future: ${state.futureBadgeColor}) followed by a step card (rounded-lg, #FAFAFA bg, 1px #E5E5E5 border).`);

  if (state.showStepActors) {
    p.push(`Show a small actor tag on each step (dot + actor name) color-coded by actor type.`);
  }
  if (state.showConnectors) {
    p.push(`Add subtle vertical connector lines between steps (gray for current, light green for future).`);
  }
  if (state.showTimes) {
    p.push(`Show estimated time per step in muted text below the label.`);
  }
  if (state.showPainBenefit) {
    const styleDesc = state.painStyle === 'subtle-bg' ? 'subtle gray background' : state.painStyle === 'gray-normal' ? 'gray normal text' : 'muted italic text';
    p.push(`Show pain descriptions on current steps as ${styleDesc}, and benefit descriptions on future steps in green italic.`);
  }
  if (state.showROI) {
    p.push(`Include an ROI footer bar showing: time saved %, automation coverage progress bar, cost/week, cost/year, steps automated.`);
  }

  p.push(`Brand colors: Green #3FAF7A, Dark Green #25785A, Navy #0A1E2F, Text #333, Secondary #666, Muted #999, Borders #E5E5E5, Page bg #F4F4F4. Font: Inter.`);

  document.getElementById('prompt-text').textContent = p.join('\n\n');
}

function updateAll() { renderPreview(); updatePrompt(); }

function copyPrompt() {
  navigator.clipboard.writeText(document.getElementById('prompt-text').textContent).then(() => {
    const btn = document.getElementById('copy-btn');
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 1500);
  });
}

updateAll();
</script>
</body>
</html>
